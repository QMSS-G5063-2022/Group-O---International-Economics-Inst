edge.col=Net%e%'inv_tot',
edge.lwd=Net%e%'inv_tot'/500,
vertex.cex=0.5,
vertex.col='#AA555555',
vertex.border='white',
jitter=FALSE)
}
net15<-make_net(2015)
knitr::opts_chunk$set(message=F, warning=F)
library(tmap)
data("World")
hr<-read.csv('HR Data/Human Rights Protections/HumanRightsProtectionScores_v4.01.csv')
library(dplyr)
disap<-filter(hr, !is.na(DISAP))[c("YEAR","DISAP","country_name")]
library(stringr)
World$name<-str_replace(World$name,"Central African Republicblic", "Central African Rep.")
World$name<-str_replace(World$name,"Dominican Republicblic", "Dominican Rep.")
World$name<-str_replace(World$name,"Bosnia and Herz.", "Bosnia & Herzegovina")
World$name<-str_replace(World$name,"Trinidad and Tobago", "Trinidad & Tobago")
World[World$name=="Congo",]$name<-"Rep. of Congo"
World[World$name=="Macedonia",]$name<-"North Macedonia"
World$name<-str_replace(World$name,"Lao PDR", "Laos")
World[World$name=="Solomon Is.",]$name<-"Solomon Islands"
disap$country_name<-str_replace(disap$country_name,"Central African Republic", "Central African Rep.")
disap$country_name<-str_replace(disap$country_name,"Dominican Republic", "Dominican Rep.")
disap$country_name<-str_replace(disap$country_name, "CÃ´te dâ€™Ivoire", "Cote d'Ivoire")
disap$country_name<-str_replace(disap$country_name, "North Korea", "Dem. Rep. Korea")
disap$country_name<-str_replace(disap$country_name, "South Korea", "Korea")
disap[disap$country_name=="Myanmar (Burma)",]$country_name<-"Myanmar"
disap$country_name<-str_replace(disap$country_name, "Czechia", "Czech Rep.")
disap$country_name<-str_replace(disap$country_name, "Congo - Kinshasa", "Dem. Rep. Congo")
disap$country_name<-str_replace(disap$country_name, "Congo - Brazzaville", "Rep. of Congo")
disap[disap$country_name=="Yemen Arab Republic",]$country_name<-"Yemen"
disap<-rename(disap,name=country_name)
trial<-full_join(World, disap, by="name")
tm_shape(filter(trial, YEAR==2005 & !is.na(sovereignt))) +
tm_polygons("DISAP", palette="Blues",
title="Disappearances")
tm_shape(filter(trial, YEAR==2008 & !is.na(sovereignt))) +
tm_polygons("DISAP", palette="Blues",
title="Disappearances")
library(vdemdata)
f<-vdem
f<-rename(f,name=country_name)
f$year<-as.numeric(f$year)
f<-filter(f, year>1990)
#tm_shape(filter(g, year==2008 & !is.na(v2elfrfair))) +
#tm_polygons("v2elfrfair", palette="Blues",
#            title="Free and Fair Elections")
f[f$name=="United States of America",]$name<-"United States"
f[f$name=="South Korea",]$name<-"Korea"
f[f$name=="North Korea",]$name<-"Dem. Rep. Korea"
f[f$name=="Republic of the Congo",]$name<-"Rep. of Congo"
f[f$name=="Burma/Myanmar",]$name<-"Myanmar"
f[f$name=="Ivory Coast",]$name<-"Cote d'Ivoire"
f[f$name=="Central African Republic",]$name<-"Central African Rep."
f[f$name=="The Gambia",]$name<-"Gambia"
f[f$name=="Trinidad and Tobago",]$name<-"Trinidad & Tobago"
f[f$name=="Palestine/Gaza",]$name<-"Palestine"
f[f$name=="Democratic Republic of the Congo",]$name<-"Dem. Rep. Congo"
g<-filter(full_join(World, f, by="name"), name %in% World$name)
tm_shape(g) +
tm_polygons("v2x_egaldem", palette="Blues",
title="Egalitarian Democracy Index")
chn_inv<-read.csv('China-Global-Investment-Tracker-2021-Fall-FINAL-2022.2.21-update.up.csv')
chn_inv<-chn_inv %>%
group_by(Year, Country) %>%
mutate(inv_tot = sum(as.numeric(gsub("[[:punct:]]", "", Quantity.in.Millions))))
chn_inv<-rename(chn_inv, name=Country, year=Year)
chn_inv[chn_inv$name=="USA",]$name<-"United States"
chn_inv[chn_inv$name=="UAE",]$name<-"United Arab Emirates"
chn_inv[chn_inv$name=="Britain",]$name<-"United Kingdom"
chn_inv[chn_inv$name=="Russian Federation",]$name<-"Russia"
chn_inv[chn_inv$name=="Democratic Republic of the Congo",]$name<-"Dem. Rep. Congo"
chn_inv[chn_inv$name=="Czech Republic",]$name<-"Czech Rep."
chn_inv[chn_inv$name=="South Korea",]$name<-"Korea"
chn_inv[chn_inv$name=="North Korea",]$name<-"Dem. Rep. Korea"
chn_inv[chn_inv$name=="Ivory Coast",]$name<-"Cote d'Ivoire"
chn_inv[chn_inv$name=="Macedonia",]$name<-"North Macedonia"
chn_inv[chn_inv$name=="Trinidad-Tobago",]$name<-"Trinidad & Tobago"
chn_inv[chn_inv$name=="Congo",]$name<-"Rep. of Congo"
chn_inv[chn_inv$name=="South Sudan",]$name<-"S. Sudan"
g<-full_join(g, chn_inv[-2], by=c("name","year"))
g[is.na(g$inv_tot),]$inv_tot<-0
tm_shape(filter(g[1:7375,],year==2007)) +
tm_polygons("inv_tot", palette="Blues",
title="Total Chinese Investment 2007")
inv07<-filter(chn_inv, year==2007)
net07<-data.frame(rep("China",length(unique(inv07$name))),unique(inv07$name))
colnames(net07)<-c("Source","Target")
net07<-left_join(net07, inv07[c("name","inv_tot")],by=c("Target"="name"))
net07<-net07[!duplicated(net07$Target),]
net07$Target<-str_to_lower(net07$Target)
net07$Source<-str_to_lower(net07$Source)
net07[net07$Target=="united arab emirates",]$Target<-"uae"
net07[net07$Target=="united states",]$Target<-"usa"
net07[net07$Target=="united kingdom",]$Target<-"uk"
View(net07)
View(net15)
View(net_dat)
net_dat[net_dat$Target=="united arab emirates",]$Target<-"uae"
net_dat[net_dat$Target=="united states",]$Target<-"usa"
net_dat[net_dat$Target=="united kingdom",]$Target<-"uk"
make_thing<-function(){
j<-filter(chn_inv, Year==min(chn_inv$Year))[!duplicated(filter(chn_inv, Year==min(chn_inv$Year))$Country), c("Country","Year","inv_tot")]
for(year in unique(chn_inv$Year)[-1]){
j<-rbind(j, filter(chn_inv, Year==year)[!duplicated(filter(chn_inv, Year==year)$Country), c("Country", "Year", "inv_tot")])
}
j["Source"]<-rep("china",nrow(j))
j<-j[c(4,1,2,3)]
colnames(j)[2]<-"Target"
j
}
net_dat<-make_thing()
View(chn_inv)
chn_inv<-read.csv('China-Global-Investment-Tracker-2021-Fall-FINAL-2022.2.21-update.up.csv')
chn_inv<-chn_inv %>%
group_by(Year, Country) %>%
mutate(inv_tot = sum(as.numeric(gsub("[[:punct:]]", "", Quantity.in.Millions))))
make_thing<-function(){
j<-filter(chn_inv, Year==min(chn_inv$Year))[!duplicated(filter(chn_inv, Year==min(chn_inv$Year))$Country), c("Country","Year","inv_tot")]
for(year in unique(chn_inv$Year)[-1]){
j<-rbind(j, filter(chn_inv, Year==year)[!duplicated(filter(chn_inv, Year==year)$Country), c("Country", "Year", "inv_tot")])
}
j["Source"]<-rep("china",nrow(j))
j<-j[c(4,1,2,3)]
colnames(j)[2]<-"Target"
j
}
net_dat<-make_thing()
rm(make_thing)
net_dat$Target<-stringr::str_to_lower(net_dat$Target)
net_dat[net_dat$Target=="united arab emirates",]$Target<-"uae"
net_dat[net_dat$Target=="united states",]$Target<-"usa"
net_dat[net_dat$Target=="united kingdom",]$Target<-"uk"
View(net15)
View(net_dat)
make_net<-function(year){
Net<-network(filter(net_dat, Year==year)[c("Source","Target","inv_tot")], matrix.type="edgelist", directed=F)
Net%v%'lon'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lon
})
Net%v%'lat'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lat
})
maps::map('world',fill=TRUE,col='#f2f2f2',lwd=0.08)
plot.network(Net,
new=FALSE,
coord=cbind(Net%v%'lon',Net%v%'lat'),
edge.col=Net%e%'inv_tot',
edge.lwd=Net%e%'inv_tot'/500,
vertex.cex=0.5,
vertex.col='#AA555555',
vertex.border='white',
jitter=FALSE)
}
net15<-make_net(2015)
Net<-network(net07,
matrix.type='edgelist',
directed=F
)
Net%v%'lon'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lon
})
Net%v%'lat'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lat
})
maps::map('world',fill=TRUE,col='#f2f2f2',lwd=0.08)
plot.network(Net,
new=FALSE,
coord=cbind(Net%v%'lon',Net%v%'lat'),
edge.col=Net%e%'inv_tot',
edge.lwd=Net%e%'inv_tot'/500,
vertex.cex=0.5,
vertex.col='#AA555555',
vertex.border='white',
jitter=FALSE)
Net<-network(filter(net_dat, Year==year)[c("Source","Target","inv_tot")], matrix.type="edgelist", directed=F)
Net<-network(filter(net_dat, Year==2015)[c("Source","Target","inv_tot")], matrix.type="edgelist", directed=F)"
)
)
)
f
}
)))))))))))))))
stop()
""
Net<-network(filter(net_dat, Year==2015)[c("Source","Target","inv_tot")], matrix.type="edgelist", directed=F)
Net%v%'lon'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lon
})
Net%v%'lat'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lat
})
maps::map('world',fill=TRUE,col='#f2f2f2',lwd=0.08)
plot.network(Net,
new=FALSE,
coord=cbind(Net%v%'lon',Net%v%'lat'),
edge.col=Net%e%'inv_tot',
edge.lwd=Net%e%'inv_tot'/500,
vertex.cex=0.5,
vertex.col='#AA555555',
vertex.border='white',
jitter=FALSE)
Net<-network(net07,
matrix.type='edgelist',
directed=F
)
Net%v%'lon'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lon
})
Net%v%'lat'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lat
})
maps::map('world',fill=TRUE,col='#f2f2f2',lwd=0.08)
plot.network(Net,
new=FALSE,
coord=cbind(Net%v%'lon',Net%v%'lat'),
edge.col=Net%e%'inv_tot',
edge.lwd=Net%e%'inv_tot'/500,
vertex.cex=0.5,
vertex.col='#AA555555',
vertex.border='white',
jitter=FALSE)
Net<-network(filter(net_dat, Year==2015)[c("Source","Target","inv_tot")], matrix.type="edgelist", directed=F)
Net%v%'lon'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lon
})
Net%v%'lat'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lat
})
Neta<-network(net07,
matrix.type='edgelist',
directed=F
)
Neta%v%'lon'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lon
})
Neta%v%'lat'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lat
})
maps::map('world',fill=TRUE,col='#f2f2f2',lwd=0.08)
plot.network(Neta,
new=FALSE,
coord=cbind(Net%v%'lon',Net%v%'lat'),
edge.col=Net%e%'inv_tot',
edge.lwd=Net%e%'inv_tot'/500,
vertex.cex=0.5,
vertex.col='#AA555555',
vertex.border='white',
jitter=FALSE)
View(net15)
View(Neta)
View(filter(net_dat, Year==2015))
View(filter(net_dat, Year==2007))
View(sorted(filter(net_dat, Year==2015), desc(Target)))
View(sort(filter(net_dat, Year==2015), desc(Target)))
View(sort(filter(net_dat, Year==2015), desc(net_dat$Target)))
View(filter(net_dat, Year==2015)[order(filter(net_dat, Year==2015)$Year), desc=T])
View(filter(net_dat, Year==2015)[order(Target)])
View(filter(net_dat, Year==2015)[order(Target),])
View(filter(net_dat, Year==2015)[order(filter(net_dat, Year==2015)$Target),])
Neta<-network(net07,
matrix.type='edgelist',
directed=F
)
Neta%v%'lon'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lon
})
Neta%v%'lat'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lat
})
maps::map('world',fill=TRUE,col='#f2f2f2',lwd=0.08)
plot.network(Neta,
new=FALSE,
coord=cbind(Neta%v%'lon',Neta%v%'lat'),
edge.col=Neta%e%'inv_tot',
edge.lwd=Neta%e%'inv_tot'/500,
vertex.cex=0.5,
vertex.col='#AA555555',
vertex.border='white',
jitter=FALSE)
Net<-network(net07,
matrix.type='edgelist',
directed=F
)
Net%v%'lon'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lon
})
Net%v%'lat'<-sapply(network.vertex.names(Net),function(name){
rawnodes[rawnodes$ID==name,]$lat
})
maps::map('world',fill=TRUE,col='#f2f2f2',lwd=0.08)
plot.network(Net,
new=FALSE,
coord=cbind(Net%v%'lon',Net%v%'lat'),
edge.col=Net%e%'inv_tot',
edge.lwd=Net%e%'inv_tot'/500,
vertex.cex=0.5,
vertex.col='#AA555555',
vertex.border='white',
jitter=FALSE)
nodes<-rename(rawnodes[c("ID","lon","lat")],name=ID)
View(nodes)
View(net_dat)
View(nodes)
View(nodes)
nodes<-filter(nodes, name %in% c(filter(net_dat, Year==2015)$Target,"china"))
View(nodes)
make_map<-function(year){
nodes<-rename(rawnodes[c("ID","lon","lat")],name=ID)
nodes<-filter(nodes, name %in% c(filter(net_dat, Year==year)$Target,"china"))
nodes$id<-as.integer(rownames(nodes))
nodes<-nodes[c(4,2,3,1)]
nodes
}
nodes<-make_map(2015)
View(nodes)
edges<-data.frame(rep(nodes[nodes$name=="china","id"],nrow(nodes)-1),nodes[nodes$name!="china","id"])
View(edges)
colnames(edges)<-c("from","to")
edges$inv<-rep(0,nrow(edges))
View(edges)
for(i in 1:nrow(edges)){
p<-nodes[nodes$id==edges$to[i],"name"]
p<-str_to_title(p)
edges$inv[i]<-inv07[inv07$name==p,"inv_tot"][[1]]
}
p<-nodes[nodes$id==edges$to[1],"name"]
p
filter(net_dat, Year==year)[filter(net_dat, Year==year)$name==p,"inv_tot"]
filter(net_dat, Year==year)[filter(net_dat, Year==2015)$name==p,"inv_tot"]
filter(net_dat, Year==2015)[filter(net_dat, Year==2015)$name==p,"inv_tot"]
filter(net_dat, Year==2015)[filter(net_dat, Year==2015)$Target==p,"inv_tot"]
filter(net_dat, Year==2015)[filter(net_dat, Year==2015)$Target==p,"inv_tot"][[1]]
make_map<-function(year){
nodes<-rename(rawnodes[c("ID","lon","lat")],name=ID)
nodes<-filter(nodes, name %in% c(filter(net_dat, Year==year)$Target,"china"))
nodes$id<-as.integer(rownames(nodes))
nodes<-nodes[c(4,2,3,1)]
edges<-data.frame(rep(nodes[nodes$name=="china","id"],nrow(nodes)-1),nodes[nodes$name!="china","id"])
colnames(edges)<-c("from","to")
for(i in 1:nrow(edges)){
p<-nodes[nodes$id==edges$to[i],"name"]
edges$inv[i]<-filter(net_dat, Year==year)[filter(net_dat, Year==year)$Target==p,"inv_tot"][[1]]
}
graph_from_data_frame(edges, directed = FALSE, vertices = nodes)
}
make_map(2015)
suppressPackageStartupMessages(library(igraph))
make_map<-function(year){
nodes<-rename(rawnodes[c("ID","lon","lat")],name=ID)
nodes<-filter(nodes, name %in% c(filter(net_dat, Year==year)$Target,"china"))
nodes$id<-as.integer(rownames(nodes))
nodes<-nodes[c(4,2,3,1)]
edges<-data.frame(rep(nodes[nodes$name=="china","id"],nrow(nodes)-1),nodes[nodes$name!="china","id"])
colnames(edges)<-c("from","to")
for(i in 1:nrow(edges)){
p<-nodes[nodes$id==edges$to[i],"name"]
edges$inv[i]<-filter(net_dat, Year==year)[filter(net_dat, Year==year)$Target==p,"inv_tot"][[1]]
}
graph_from_data_frame(edges, directed = FALSE, vertices = nodes)
}
make_map(2015)
View(nodes)
View(net_dat)
h<-rename(net_dat[c("Source", "Target", "inv_tot"), FROM=Source, TO=Target])
h<-rename(net_dat[c("Source", "Target", "inv_tot")], FROM=Source, TO=Target])
net_dat[c("Source", "Target", "inv_tot")]
h<-dplyr::rename(net_dat[c("Source", "Target", "inv_tot")], FROM=Source, TO=Target])
h<-dplyr::rename(net_dat[c("Source", "Target", "inv_tot"),], FROM=Source, TO=Target])
h<-
h<-dplyr::rename(net_dat[c("Source", "Target", "inv_tot"),], FROM=Source, TO=Target)
View(h)
h<-dplyr::rename(net_dat[c("Source", "Target", "inv_tot"),], FROM=Source, TO=Target)
View(h)
h<-dplyr::rename(net_dat[c("Source", "Target", "inv_tot")], FROM=Source, TO=Target)
View(h)
h<-dplyr::rename(filter(net_dat,Year==2015)[c("Source", "Target", "inv_tot")], FROM=Source, TO=Target)
View(nodes)
u<-nodes[c(4,3,2)]
View(u)
graph.data.frame(h, directed = T, vertices = nodes)
graph.data.frame(h, directed = T, vertices = u)
setdiff(h$TO, u$name)
"united kingdom" %in% u$name
View(nodes)
View(rawnodes)
setdiff(chn_inv$Country, rawnodes$ID)
chn_inv<-read.csv('China-Global-Investment-Tracker-2021-Fall-FINAL-2022.2.21-update.up.csv')
chn_inv<-read.csv('China-Global-Investment-Tracker-2021-Fall-FINAL-2022.2.21-update.up.csv')
getwd()
chn_inv<-read.csv('Group-O---International-Economics-Inst/China-Global-Investment-Tracker-2021-Fall-FINAL-2022.2.21-update.up.csv')
chn_inv<-chn_inv %>%
group_by(Year, Country) %>%
mutate(inv_tot = sum(as.numeric(gsub("[[:punct:]]", "", Quantity.in.Millions))))
setdiff(chn_inv$Country, rawnodes$ID)
rawnodes$ID
setdiff(stringr::str_to_lower(chn_inv$Country), rawnodes$ID)
chn_inv$Country<-stringr::str_to_lower(chn_inv$Country)
setdiff(chn_inv$Country, rawnodes$ID)
chn_inv[chn_inv$Country=="britain"]$country<-"uk"
chn_inv[chn_inv$Country=="britain",]$country<-"uk"
chn_inv[chn_inv$Country=="britain",]$Country<-"uk"
setdiff(chn_inv$Country, rawnodes$ID)
chn_inv[chn_inv$Country=="myanmar",]$Country<-"burma"
chn_inv[chn_inv$Country=="russian federation",]$Country<-"russia"
chn_inv[chn_inv$Country=="myanmar",]$Country<-"burma"
setdiff(chn_inv$Country, rawnodes$ID)
unique(rawnodes$ID)[grep("congo",rawnodes$ID)]
unique(rawnodes$ID)[grep("trinidad",rawnodes$ID)]
unique(rawnodes$ID)[grep("ivor",rawnodes$ID)]
unique(rawnodes$ID)[grep("cote",rawnodes$ID)]
unique(rawnodes$ID)[grep("ivory",rawnodes$ID)]
chn_inv[chn_inv$Country=="trinidad-tobago",]$Country<-"trinidad and tobago"
chn_inv[chn_inv$Country=="bosnia",]$Country<-"bosnia and herzegovina"
chn_inv[chn_inv$Country=="sao tome",]$Country<-"uk"
setdiff(chn_inv$Country, rawnodes$ID)
make_thing<-function(){
j<-filter(chn_inv, Year==min(chn_inv$Year))[!duplicated(filter(chn_inv, Year==min(chn_inv$Year))$Country), c("Country","Year","inv_tot")]
for(year in unique(chn_inv$Year)[-1]){
j<-rbind(j, filter(chn_inv, Year==year)[!duplicated(filter(chn_inv, Year==year)$Country), c("Country", "Year", "inv_tot")])
}
j["Source"]<-rep("china",nrow(j))
j<-j[c(4,1,2,3)]
colnames(j)[2]<-"Target"
j
}
net_dat<-make_thing()
rm(make_thing)
net_dat[net_dat$Target=="united arab emirates",]$Target<-"uae"
net_dat[net_dat$Target=="united states",]$Target<-"usa"
net_dat[net_dat$Target=="united kingdom",]$Target<-"uk"
h<-dplyr::rename(filter(net_dat,Year==2015)[c("Source", "Target", "inv_tot")], FROM=Source, TO=Target)
u<-nodes[c(4,3,2)]
setdiff(h$TO, u$name)
rawnodes<-read.csv('http://www.kateto.net/wordpress/wp-content/uploads/2015/06/Country_terms_FREQ.csv')
rawnodes<-read.csv('http://www.kateto.net/wordpress/wp-content/uploads/2015/06/Country_terms_FREQ.csv')
rawedges<-read.csv('http://www.kateto.net/wordpress/wp-content/uploads/2015/06/Country_terms_COOC.csv')
chn_inv<-read.csv('Group-O---International-Economics-Inst/China-Global-Investment-Tracker-2021-Fall-FINAL-2022.2.21-update.up.csv')
chn_inv<-chn_inv %>%
group_by(Year, Country) %>%
mutate(inv_tot = sum(as.numeric(gsub("[[:punct:]]", "", Quantity.in.Millions))))
chn_inv$Country<-stringr::str_to_lower(chn_inv$Country)
chn_inv[chn_inv$Country=="britain",]$Country<-"uk"
chn_inv[chn_inv$Country=="myanmar",]$Country<-"burma"
chn_inv[chn_inv$Country=="russian federation",]$Country<-"russia"
chn_inv[chn_inv$Country=="trinidad-tobago",]$Country<-"trinidad and tobago"
chn_inv[chn_inv$Country=="bosnia",]$Country<-"bosnia and herzegovina"
chn_inv[chn_inv$Country=="sao tome",]$Country<-"uk"
setdiff(chn_inv$Country, rawnodes$ID)
make_thing<-function(){
j<-filter(chn_inv, Year==min(chn_inv$Year))[!duplicated(filter(chn_inv, Year==min(chn_inv$Year))$Country), c("Country","Year","inv_tot")]
for(year in unique(chn_inv$Year)[-1]){
j<-rbind(j, filter(chn_inv, Year==year)[!duplicated(filter(chn_inv, Year==year)$Country), c("Country", "Year", "inv_tot")])
}
j["Source"]<-rep("china",nrow(j))
j<-j[c(4,1,2,3)]
colnames(j)[2]<-"Target"
j
}
net_dat<-make_thing()
rm(make_thing)
View(net_dat)
h<-dplyr::rename(filter(net_dat,Year==2015)[c("Source", "Target", "inv_tot")], FROM=Source, TO=Target)
View(h)
u<-nodes[c(4,3,2)]
View(u)
nodes<-rename(rawnodes[c("ID","lon","lat")],name=ID)
nodes<-filter(nodes, name %in% c(filter(net_dat, Year==year)$Target,"china"))
nodes<-filter(nodes, name %in% c(filter(net_dat, Year==2015)$Target,"china"))
View(nodes)
nodes$id<-as.integer(rownames(nodes))
nodes<-nodes[c(4,2,3,1)]
View(nodes)
u<-nodes[c(4,3,2)]
graph.data.frame(h, directed=T,vertices=u)
setdiff(h$TO, u$name)
graph.data.frame(filter(h, !TO%in%setdiff(h$TO, u$name)), directed=T, vertices=u)
make_map<-function(year){
nodes<-rename(rawnodes[c("ID","lon","lat")],name=ID)
nodes<-filter(nodes, name %in% c(filter(net_dat, Year==year)$Target,"china"))
nodes$id<-as.integer(rownames(nodes))
nodes<-nodes[c(4,2,3,1)]
edges<-data.frame(rep(nodes[nodes$name=="china","id"],nrow(nodes)-1),nodes[nodes$name!="china","id"])
colnames(edges)<-c("from","to")
for(i in 1:nrow(edges)){
p<-nodes[nodes$id==edges$to[i],"name"]
edges$inv[i]<-filter(net_dat, Year==year)[filter(net_dat, Year==year)$Target==p,"inv_tot"][[1]]
}
graph_from_data_frame(edges, directed = FALSE, vertices = nodes)
}
make_map(2015)
network_<-get.data.frame(graph.data.frame(filter(h, !TO%in%setdiff(h$TO, u$name)), directed=T, vertices=u), "both")
verts_<-network_$vertices
coordinates(verts_)<-~lon+lat
coordinates(vers_)
coordinates(verts_)
edges_<-network_$edges
edges_
View(edges_)
edges_<-lapply(1:nrow(edges_),function(i){
as(rbind(verts_[verts_$name==edges_[i, "from"],],
verts+[verts_$name==edges_[i, "to"],]),
edges_<-lapply(1:nrow(edges_),function(i){
as(rbind(verts_[verts_$name==edges_[i, "from"],],
verts_[verts_$name==edges_[i, "to"],]),
"SpatialLines")
})
for(i in seq_along(edges)){
edges[[i]]<-spChFIDs(edges[[i]], as.character(i))
}
